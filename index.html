<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Powerme Girl's Pocket</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Powerme Pocket">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root { --theme-color: #EC4899; --theme-light: #FBCFE8; --theme-bg: #FFF0F5; --theme-fade: rgba(236, 72, 153, 0.1); }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--theme-bg); color: #4A4A4A; -webkit-tap-highlight-color: transparent; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); transition: background-color 0.3s ease; }
        .font-ticket { font-family: 'Space Mono', monospace; }
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: var(--theme-light); border-radius: 10px; }
        .washi-header { background-color: rgba(255, 255, 255, 0.95); background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, var(--theme-fade) 10px, var(--theme-fade) 20px); box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 1px solid var(--theme-light); }
        .toggle-checkbox:checked { right: 0; border-color: var(--theme-color); } .toggle-checkbox:checked + .toggle-label { background-color: var(--theme-color); }
        .cute-input { border: 2px solid var(--theme-light); border-radius: 16px; padding: 10px 14px; outline: none; transition: all 0.2s; background: #FFF; font-size: 14px; width: 100%; }
        .cute-input:focus { border-color: var(--theme-color); box-shadow: 0 0 0 3px var(--theme-fade); }
        .dashed-line { background-image: linear-gradient(to right, var(--theme-light) 50%, rgba(255,255,255,0) 0%); background-position: bottom; background-size: 10px 2px; background-repeat: repeat-x; height: 2px; }
        .jp-ticket { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 10px 15px var(--theme-fade); position: relative; overflow: hidden; border: 1px solid #FEE2E2; }
        .jp-ticket::before, .jp-ticket::after { content: ""; position: absolute; top: 54%; width: 24px; height: 24px; background-color: #FAFAFA; border-radius: 50%; z-index: 10; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); pointer-events: none; }
        .jp-ticket::before { left: -12px; } .jp-ticket::after { right: -12px; }
        .jp-ticket-header { background: var(--theme-color); background-image: radial-gradient(rgba(255,255,255,0.3) 15%, transparent 16%), radial-gradient(rgba(255,255,255,0.3) 15%, transparent 16%); background-size: 10px 10px; background-position: 0 0, 5px 5px; color: white; padding: 8px 16px; font-size: 12px; font-weight: 900; letter-spacing: 2px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px dashed rgba(255,255,255,0.5); }
        .jp-ticket-body { padding: 16px 20px; position: relative; z-index: 20; }
        .ticket-input { width: 100%; text-align: center; background: transparent; border-bottom: 2px solid #F3F4F6; border-radius: 0; padding: 4px 0; font-family: 'Space Mono', monospace; font-weight: 700; color: #374151; outline: none; transition: border-color 0.3s; position: relative; z-index: 30; }
        .ticket-input:focus { border-bottom-color: var(--theme-color); }
        .time-select { appearance: none; background: transparent; font-family: 'Space Mono', monospace; font-weight: 700; color: #374151; border: none; border-bottom: 2px solid #F3F4F6; border-radius: 0; text-align: center; padding: 2px 0; outline: none; width: 100%; }
        .time-select:focus { border-bottom-color: var(--theme-color); }
        .stamp-btn { border: 2px solid #E5E7EB; color: #9CA3AF; border-radius: 8px; padding: 6px 4px; font-size: 10px; font-weight: bold; transition: all 0.2s; position: relative; background: #F9FAFB; z-index: 30; }
        .stamp-btn.active { border-color: var(--theme-color); color: var(--theme-color); background: rgba(255,255,255,0.8); box-shadow: 0 0 0 2px var(--theme-fade); transform: rotate(-3deg) scale(1.05); }
        .stamp-btn.active::after { content: "âœ”"; position: absolute; top: -6px; right: -6px; width: 14px; height: 14px; background: var(--theme-color); color: white; font-size: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .seat-btn { flex: 1; padding: 6px; font-size: 11px; font-weight: bold; border-radius: 8px; border: 2px solid #E5E7EB; color: #9CA3AF; transition: all 0.2s; background: #F9FAFB; }
        .seat-btn.selected { border-color: var(--theme-color); color: white; background: var(--theme-color); box-shadow: 0 2px 5px var(--theme-fade); }
        .color-swatch { width: 36px; height: 36px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .color-swatch.selected { border-color: #4B5563; transform: scale(1.1); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        @keyframes float { 0% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-5px) rotate(2deg); } 100% { transform: translateY(0px) rotate(0deg); } }
        .animate-float { animation: float 4s ease-in-out infinite; }
        .logo-sticker { filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); transition: transform 0.3s ease; }
        .logo-sticker:hover { transform: scale(1.05) rotate(2deg); }
        .sticker-btn { border: 3px solid white; box-shadow: 2px 3px 0px rgba(0,0,0,0.1); transition: all 0.2s; }
        .sticker-btn:active { transform: translateY(2px); box-shadow: none; }
        
        /* Emergency Reset Button - Moved to Bottom Right */
        #safe-reset-btn { 
            position: fixed; 
            bottom: 40px; /* Avoid Dynamic Island and bottom bar */
            right: 20px; 
            z-index: 999999; 
            background-color: #EF4444; 
            color: white; 
            border: 2px solid white; 
            padding: 10px 16px; 
            border-radius: 50px; 
            font-weight: bold; 
            font-size: 12px; 
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); 
            cursor: pointer; 
            opacity: 0; /* Hidden by default */
            pointer-events: none;
            transition: opacity 0.3s, transform 0.2s;
        }
        #safe-reset-btn.visible {
            opacity: 0.9;
            pointer-events: auto;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    
    <button id="safe-reset-btn" onclick="if(confirm('å¦‚æœç•«é¢å¡ä½æˆ–å…¨ç™½ï¼ŒæŒ‰é€™å€‹å¯ä»¥é‡ç½®è³‡æ–™ä¿®å¾©ã€‚ç¢ºå®šè¦é‡ç½®å—ï¼Ÿ')){localStorage.clear();window.location.reload();}">
        ğŸš‘ é»æˆ‘ä¿®å¾©ç™½ç•«é¢
    </button>

    <div id="loading-ui" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #FFF0F5; z-index: 9999;">
        <div style="font-size: 60px; animation: bounce 1s infinite;">ğŸ</div>
        <div style="color: #EC4899; font-family: sans-serif; margin-top: 16px; font-weight: bold; font-size: 16px; letter-spacing: 2px;">LOADING...</div>
        <style>@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }</style>
    </div>

    <div id="root"></div>

    <script>
        // Only show reset button if loading takes more than 2 seconds (likely stuck)
        setTimeout(function(){
            var btn = document.getElementById('safe-reset-btn');
            var loader = document.getElementById('loading-ui');
            // If loader is still there, it means React hasn't hydrated -> Stuck
            if(btn && loader && loader.style.display !== 'none') {
                btn.classList.add('visible');
            }
        }, 2000);
        
        window.onerror = function(message) {
            // If error occurs, show the button immediately
            var btn = document.getElementById('safe-reset-btn');
            if(btn && !message.includes("ResizeObserver")) {
               btn.classList.add('visible');
               console.error("App Error: " + message);
            }
        };
    </script>

    <script type="text/babel">
        // Hide Loading UI when React starts
        const hideLoader = () => {
            const loader = document.getElementById('loading-ui');
            if(loader) loader.style.display = 'none';
        };

        const { useState, useEffect, useMemo } = React;

        const THEMES = [
            { id: 'pink', name: 'ç”œå¿ƒç²‰', color: '#EC4899', light: '#FBCFE8', bg: '#FFF0F5' },
            { id: 'blue', name: 'æ‡‰æ´è—', color: '#0EA5E9', light: '#BAE6FD', bg: '#F0F9FF' },
            { id: 'orange', name: 'æ´»åŠ›æ©˜', color: '#F97316', light: '#FED7AA', bg: '#FFF7ED' },
            { id: 'purple', name: 'å¤¢å¹»ç´«', color: '#A855F7', light: '#E9D5FF', bg: '#FAF5FF' },
            { id: 'green', name: 'æ¸…æ–°ç¶ ', color: '#10B981', light: '#A7F3D0', bg: '#ECFDF5' },
        ];

        const ICON_PATHS = {
            X: <><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>,
            Train: <><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h0"/><path d="M16 15h0"/></>,
            ArrowRight: <><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></>,
            Edit2: <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>,
            MapPin: <><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>,
            Sun: <><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>,
            Cloud: <path d="M17.5 19c0-1.7-1.3-3-3-3h-11c-1.7 0-3 1.3-3 3s1.3 3 3 3h11c1.7 0 3-1.3 3-3z"/>,
            CloudSun: <><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/></>,
            CloudRain: <><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></>,
            Bed: <><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></>,
            BookHeart: <><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="M12 8a2 2 0 1 1 0 4 2 2 0 0 1 0-4Z" fill="currentColor" fillOpacity="0.2"/></>,
            BarChart2: <><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></>,
            LogOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></>,
            Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
            Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>,
            Sparkles: <><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></>,
            Check: <polyline points="20 6 9 17 4 12"/>,
            Navigation: <polygon points="3 11 22 2 13 21 11 13 3 11"/>,
            QrCode: <><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></>,
            Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>,
            Trash: <><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></>,
            Notebook: <><path d="M16 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></>,
            Wallet: <><rect width="18" height="12" x="2" y="5" rx="2"/><path d="M6 5v14"/><path d="M18 5v14"/><line x1="2" x2="20" y1="9" y2="9"/></>
        };

        const Icon = ({ name, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {ICON_PATHS[name]}
            </svg>
        );

        // --- FARE MATRIX (2025 Standard Prices) ---
        const STATIONS = ["å—æ¸¯", "å°åŒ—", "æ¿æ©‹", "æ¡ƒåœ’", "æ–°ç«¹", "è‹—æ —", "å°ä¸­", "å½°åŒ–", "é›²æ—", "å˜‰ç¾©", "å°å—", "å·¦ç‡Ÿ"];
        const FARE_DATA = {
            "reserved": [
                [0, 40, 70, 200, 330, 480, 750, 870, 970, 1120, 1390, 1530], // Nangang
                [40, 0, 40, 160, 290, 430, 700, 820, 930, 1080, 1350, 1490], // Taipei
                [70, 40, 0, 130, 260, 400, 670, 790, 900, 1050, 1320, 1460], // Banqiao
                [200, 160, 130, 0, 130, 280, 540, 670, 780, 920, 1190, 1330], // Taoyuan
                [330, 290, 260, 130, 0, 140, 410, 540, 640, 790, 1060, 1200], // Hsinchu
                [480, 430, 400, 280, 140, 0, 270, 390, 500, 640, 920, 1060], // Miaoli
                [750, 700, 670, 540, 410, 270, 0, 130, 230, 380, 650, 790], // Taichung
                [870, 820, 790, 670, 540, 390, 130, 0, 110, 250, 530, 670], // Changhua
                [970, 930, 900, 780, 640, 500, 230, 110, 0, 150, 420, 560], // Yunlin
                [1120, 1080, 1050, 920, 790, 640, 380, 250, 150, 0, 280, 410], // Chiayi
                [1390, 1350, 1320, 1190, 1060, 920, 650, 530, 420, 280, 0, 140], // Tainan
                [1530, 1490, 1460, 1330, 1200, 1060, 790, 670, 560, 410, 140, 0]  // Zuoying
            ],
            "free": [
                [0, 35, 65, 190, 320, 465, 725, 840, 940, 1085, 1345, 1480],
                [35, 0, 35, 155, 280, 415, 675, 795, 900, 1045, 1305, 1445],
                [65, 35, 0, 125, 250, 385, 645, 765, 870, 1015, 1280, 1415],
                [190, 155, 125, 0, 125, 270, 520, 645, 755, 890, 1150, 1290],
                [320, 280, 250, 125, 0, 135, 395, 520, 620, 765, 1025, 1160],
                [465, 415, 385, 270, 135, 0, 260, 375, 485, 620, 890, 1025],
                [725, 675, 645, 520, 395, 260, 0, 125, 220, 365, 630, 765],
                [840, 795, 765, 645, 520, 375, 125, 0, 105, 240, 510, 645],
                [940, 900, 870, 755, 620, 485, 220, 105, 0, 145, 405, 540],
                [1085, 1045, 1015, 890, 765, 620, 365, 240, 145, 0, 270, 395],
                [1345, 1305, 1280, 1150, 1025, 890, 630, 510, 405, 270, 0, 135],
                [1480, 1445, 1415, 1290, 1160, 1025, 765, 645, 540, 395, 135, 0]
            ]
        };

        const getTicketPrice = (from, to, type) => {
            const idx1 = STATIONS.indexOf(from);
            const idx2 = STATIONS.indexOf(to);
            if (idx1 === -1 || idx2 === -1 || idx1 === idx2) return 0;
            const table = type === 'è‡ªç”±åº§' ? FARE_DATA.free : FARE_DATA.reserved;
            return table[idx1][idx2] || 0;
        };

        const safeGet = (key) => { try { return localStorage.getItem(key); } catch(e) { return null; } };
        const safeSet = (key, val) => { try { localStorage.setItem(key, val); } catch(e) {} };
        const safeRemove = (key) => { try { localStorage.removeItem(key); } catch(e) {} };

        const ALL_MEMBERS = ["è© å«º", "å‡Œè¥„", "æ˜•è“‰", "å®å®", "æ™ºæ™º", "æ±¶éœ–", "è—å¿ƒ", "å®¥å¿ƒ", "èŠèŠ", "éƒå€ª", "æ™‚é›¨", "è‘³æŸ”"];
        const SCHEDULE = [
            { week: 1, location: "æˆå¤§é«”è‚²é¤¨", date: "2025/11/01", day: "å…­", matches: [ { id: "w1m1", time: "13:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è© å«º", "å‡Œè¥„", "æ˜•è“‰", "å®å®"] }, { id: "w1m2", time: "18:30", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è© å«º", "å‡Œè¥„", "æ˜•è“‰", "å®å®"] } ]},
            { week: 3, location: "å½°å¸«å¤§é«”è‚²é¤¨", date: "2025/11/15", day: "å…­", matches: [ { id: "w3m1", time: "14:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™ºæ™º", "æ±¶éœ–", "è—å¿ƒ", "å®¥å¿ƒ"] }, { id: "w3m2", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ™ºæ™º", "æ±¶éœ–", "è—å¿ƒ", "å®¥å¿ƒ"] } ]},
            { week: 3, location: "å½°å¸«å¤§é«”è‚²é¤¨", date: "2025/11/16", day: "æ—¥", matches: [ { id: "w3m3", time: "15:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™ºæ™º", "æ±¶éœ–", "è—å¿ƒ", "å®¥å¿ƒ"] }, { id: "w3m4", time: "17:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ™ºæ™º", "æ±¶éœ–", "è—å¿ƒ", "å®¥å¿ƒ"] } ]},
            { week: 4, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2025/11/22", day: "å…­", matches: [ { id: "w4m1", time: "18:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™ºæ™º", "è—å¿ƒ", "èŠèŠ", "éƒå€ª"], note: "å…¶ä»– 8 äººåƒåŠ æ–°åŒ—è€¶èª•æ´»å‹•" } ]},
            { week: 4, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2025/11/23", day: "æ—¥", matches: [ { id: "w4m2", time: "15:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["å‡Œè¥„", "å®å®", "å®¥å¿ƒ", "æ˜•è“‰", "æ™‚é›¨", "æ™ºæ™º", "æ±¶éœ–", "èŠèŠ", "è‘³æŸ”", "è—å¿ƒ", "è© å«º", "éƒå€ª"], themeDay: true } ]},
            { week: 5, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2025/11/29", day: "å…­", matches: [ { id: "w5m1", time: "16:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["å®¥å¿ƒ", "è© å«º", "è‘³æŸ”", "å‡Œè¥„"] }, { id: "w5m2", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["å®¥å¿ƒ", "è© å«º", "è‘³æŸ”", "å‡Œè¥„"] } ]},
            { week: 5, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2025/11/30", day: "æ—¥", matches: [ { id: "w5m3", time: "15:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["å®¥å¿ƒ", "è© å«º", "è‘³æŸ”", "å‡Œè¥„"] }, { id: "w5m4", time: "17:00", team: "æ–°åŒ—ä¸­çº–", roster: ["å®¥å¿ƒ", "è© å«º", "è‘³æŸ”", "å‡Œè¥„"] } ]},
            { week: 6, location: "é«˜é›„å¸‚é³³å±±é«”è‚²é¤¨", date: "2025/12/06", day: "å…­", matches: [ { id: "w6m1", time: "14:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è© å«º", "å®å®", "èŠèŠ", "æ™‚é›¨"] }, { id: "w6m2", time: "18:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è© å«º", "å®å®", "èŠèŠ", "æ™‚é›¨"] } ]},
            { week: 6, location: "é«˜é›„å¸‚é³³å±±é«”è‚²é¤¨", date: "2025/12/07", day: "æ—¥", matches: [ { id: "w6m3", time: "15:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è© å«º", "å®å®", "èŠèŠ", "æ™‚é›¨"] }, { id: "w6m4", time: "17:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è© å«º", "å®å®", "èŠèŠ", "æ™‚é›¨"] } ]},
            { week: 7, location: "é«˜é›„å¸‚é³³å±±é«”è‚²é¤¨", date: "2025/12/13", day: "å…­", matches: [ { id: "w7m1", time: "18:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ±¶éœ–", "éƒå€ª", "å®¥å¿ƒ"] } ]},
            { week: 7, location: "é«˜é›„å¸‚é³³å±±é«”è‚²é¤¨", date: "2025/12/14", day: "æ—¥", matches: [ { id: "w7m2", time: "13:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ±¶éœ–", "éƒå€ª", "å®¥å¿ƒ"] } ]},
            { week: 8, location: "æ±å±±é«˜ä¸­é«”è‚²é¤¨", date: "2025/12/21", day: "æ—¥", matches: [ { id: "w8m1", time: "17:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™‚é›¨", "å®å®", "æ±¶éœ–", "å‡Œè¥„"] } ]},
            { week: 9, location: "ä¸­åŸå¤§å­¸é«”è‚²é¤¨", date: "2025/12/27", day: "å…­", matches: [ { id: "w9m1", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["éƒå€ª", "æ˜•è“‰", "æ±¶éœ–", "èŠèŠ"] } ]},
            { week: 9, location: "ä¸­åŸå¤§å­¸é«”è‚²é¤¨", date: "2025/12/28", day: "æ—¥", matches: [ { id: "w9m2", time: "13:00", team: "æ–°åŒ—ä¸­çº–", roster: ["éƒå€ª", "æ˜•è“‰", "æ±¶éœ–", "èŠèŠ"] } ]},
            { week: 10, location: "ä¸­åŸå¤§å­¸é«”è‚²é¤¨", date: "2026/01/03", day: "å…­", matches: [ { id: "w10m1", time: "14:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "æ™‚é›¨", "è© å«º"] }, { id: "w10m2", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è‘³æŸ”", "æ˜•è“‰", "æ™‚é›¨", "è© å«º"] } ]},
            { week: 10, location: "ä¸­åŸå¤§å­¸é«”è‚²é¤¨", date: "2026/01/04", day: "æ—¥", matches: [ { id: "w10m3", time: "15:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "æ™‚é›¨", "è© å«º"] }, { id: "w10m4", time: "17:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è‘³æŸ”", "æ˜•è“‰", "æ™‚é›¨", "è© å«º"] } ]},
            { week: 11, location: "æ–°åŒ—å¸‚æ–°èŠé«”è‚²é¤¨", date: "2026/01/10", day: "å…­", matches: [ { id: "w11m1", time: "16:00", team: "æ–°åŒ—ä¸­çº–", roster: ["å‡Œè¥„", "å®å®", "å®¥å¿ƒ", "æ˜•è“‰", "æ™‚é›¨", "æ™ºæ™º", "æ±¶éœ–", "èŠèŠ", "è‘³æŸ”", "è—å¿ƒ", "è© å«º", "éƒå€ª"], themeDay: true } ]},
            { week: 11, location: "æ–°åŒ—å¸‚æ–°èŠé«”è‚²é¤¨", date: "2026/01/11", day: "æ—¥", matches: [ { id: "w11m2", time: "15:00", team: "æ–°åŒ—ä¸­çº–", roster: ["å‡Œè¥„", "å®å®", "å®¥å¿ƒ", "æ˜•è“‰", "æ™‚é›¨", "æ™ºæ™º", "æ±¶éœ–", "èŠèŠ", "è‘³æŸ”", "è—å¿ƒ", "è© å«º", "éƒå€ª"], themeDay: true } ]},
            { week: 12, location: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨", date: "2026/01/17", day: "å…­", matches: [ { id: "w12m1", time: "14:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ™‚é›¨", "éƒå€ª", "å‡Œè¥„", "æ™ºæ™º"] }, { id: "w12m2", time: "18:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™‚é›¨", "éƒå€ª", "å‡Œè¥„", "æ™ºæ™º"] } ]},
            { week: 12, location: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨", date: "2026/01/18", day: "æ—¥", matches: [ { id: "w12m3", time: "13:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ™‚é›¨", "éƒå€ª", "å‡Œè¥„", "æ™ºæ™º"] }, { id: "w12m4", time: "17:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™‚é›¨", "éƒå€ª", "å‡Œè¥„", "æ™ºæ™º"] } ]},
            { week: 13, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/01/24", day: "å…­", matches: [ { id: "w13m1", time: "14:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ±¶éœ–", "å®å®", "èŠèŠ", "éƒå€ª"] } ]},
            { week: 13, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/01/25", day: "æ—¥", matches: [ { id: "w13m2", time: "13:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ±¶éœ–", "å®å®", "èŠèŠ", "éƒå€ª"] } ]},
            { week: 14, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/01/31", day: "å…­", matches: [ { id: "w14m1", time: "18:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "è—å¿ƒ", "èŠèŠ"] } ]},
            { week: 14, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/02/01", day: "æ—¥", matches: [ { id: "w14m2", time: "17:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "è—å¿ƒ", "èŠèŠ"] } ]},
            { week: 15, location: "åœ‹åŒ—æ•™å¤§é«”è‚²é¤¨", date: "2026/02/07", day: "å…­", matches: [ { id: "w15m1", time: "16:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["éƒå€ª", "è© å«º", "å‡Œè¥„", "å®å®"] }, { id: "w15m2", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["éƒå€ª", "è© å«º", "å‡Œè¥„", "å®¥å¿ƒ"] } ]},
            { week: 15, location: "åœ‹åŒ—æ•™å¤§é«”è‚²é¤¨", date: "2026/02/08", day: "æ—¥", matches: [ { id: "w15m3", time: "17:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™ºæ™º", "è—å¿ƒ", "æ˜•è“‰", "å®å®"] } ]},
            { week: 16, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2026/02/28", day: "å…­", matches: [ { id: "w16m1", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è—å¿ƒ", "æ±¶éœ–", "æ™ºæ™º", "èŠèŠ"] } ]},
            { week: 16, location: "é›²æ—ç¸£ç«‹é«”è‚²é¤¨", date: "2026/03/01", day: "æ—¥", matches: [ { id: "w16m2", time: "15:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è—å¿ƒ", "æ±¶éœ–", "æ™ºæ™º", "èŠèŠ"] } ]},
            { week: 17, location: "åŒ—è¾°åœ‹å°é«”è‚²é¤¨", date: "2026/03/07", day: "å…­", matches: [ { id: "w17m1", time: "16:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["éƒå€ª", "å®¥å¿ƒ", "èŠèŠ", "è—å¿ƒ"] } ]},
            { week: 17, location: "åŒ—è¾°åœ‹å°é«”è‚²é¤¨", date: "2026/03/08", day: "æ—¥", matches: [ { id: "w17m2", time: "15:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["éƒå€ª", "å®¥å¿ƒ", "èŠèŠ", "è—å¿ƒ"] } ]},
            { week: 18, location: "åŒ—è¾°åœ‹å°é«”è‚²é¤¨", date: "2026/03/14", day: "å…­", matches: [ { id: "w18m1", time: "14:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "å®å®", "æ™ºæ™º"] }, { id: "w18m2", time: "18:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è‘³æŸ”", "æ˜•è“‰", "å®å®", "æ™ºæ™º"] } ]},
            { week: 18, location: "åŒ—è¾°åœ‹å°é«”è‚²é¤¨", date: "2026/03/15", day: "æ—¥", matches: [ { id: "w18m3", time: "13:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["è‘³æŸ”", "æ˜•è“‰", "å®å®", "æ™ºæ™º"] }, { id: "w18m4", time: "17:00", team: "æ–°åŒ—ä¸­çº–", roster: ["è‘³æŸ”", "æ˜•è“‰", "å®å®", "æ™ºæ™º"] } ]},
            { week: 19, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/03/20", day: "äº”", matches: [ { id: "w19m1", time: "12:00", team: "æ–°åŒ—ä¸­çº–", roster: ["æ™‚é›¨", "å‡Œè¥„", "æ±¶éœ–", "è—å¿ƒ"] }, { id: "w19m2", time: "16:00", team: "é›²æ—ç¾æ´¥æ¿ƒ", roster: ["æ™‚é›¨", "å‡Œè¥„", "æ±¶éœ–", "è—å¿ƒ"] } ]},
            { week: 20, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/03/21", day: "å…­", matches: [ { id: "w20m1", time: "16:00", team: "å¥³å­çµ„è³½äº‹", roster: [] }, { id: "w20m2", time: "18:00", team: "ç”·å­çµ„è³½äº‹", roster: [] } ]},
            { week: 20, location: "å±æ±ç¸£ç«‹é«”è‚²é¤¨", date: "2026/03/22", day: "æ—¥", matches: [ { id: "w20m3", time: "15:00", team: "å¥³å­çµ„è³½äº‹", roster: [] }, { id: "w20m4", time: "17:00", team: "ç”·å­çµ„è³½äº‹", roster: [] } ]}
        ];

        const WeatherWidget = ({ location }) => {
            const temp = location.includes('å±æ±') || location.includes('é«˜é›„') ? '22-26Â°C' : '18-22Â°C';
            return (
                <div onClick={() => window.open(`https://www.google.com/search?q=${location}+å¤©æ°£`, '_blank')} className="bg-sky-50 border border-sky-100 px-3 py-1.5 rounded-xl flex items-center gap-2 shadow-sm cursor-pointer">
                    <Icon name="Sun" size={20} className="text-orange-400" />
                    <div><div className="text-xs font-bold text-gray-600 leading-none">{temp}</div><div className="text-[9px] text-gray-400 font-medium leading-none mt-0.5">æ™´æ™‚å¤šé›²</div></div>
                </div>
            );
        };

        const TimeSelector = ({ value, onChange }) => {
            const [hours, minutes] = (value || '').split(':');
            return (
                <div className="flex items-center gap-1 border-b-2 border-[#F3F4F6] focus-within:border-[var(--theme-color)] transition-colors relative z-30">
                    <select className="time-select" value={hours || ''} onChange={e => onChange(`${e.target.value}:${minutes||'00'}`)}>
                        <option value="" disabled>æ™‚</option>{[...Array(19).keys()].map(i=><option key={i+5} value={(i+5).toString().padStart(2,'0')}>{(i+5).toString().padStart(2,'0')}</option>)}
                    </select>
                    <span className="text-gray-300 font-bold">:</span>
                    <select className="time-select" value={minutes || ''} onChange={e => onChange(`${hours||'06'}:${e.target.value}`)}>
                        <option value="" disabled>åˆ†</option>{[...Array(60).keys()].map(i=><option key={i} value={i.toString().padStart(2,'0')}>{i.toString().padStart(2,'0')}</option>)}
                    </select>
                </div>
            );
        };

        const MemoCard = ({ memo, onUpdate }) => (
            <div className="bg-white border-2 border-dashed border-[var(--theme-light)] rounded-2xl p-4 mt-6 relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-2 bg-[var(--theme-light)] opacity-50"></div>
                <div className="flex items-center gap-2 mb-2 text-gray-500 font-bold text-sm">
                    <Icon name="Notebook" size={16} className="text-[var(--theme-color)]"/><span>MEMO å‚™å¿˜éŒ„</span>
                </div>
                <textarea className="w-full bg-[var(--theme-bg)] rounded-xl p-3 text-sm text-gray-700 outline-none resize-none focus:ring-2 focus:ring-[var(--theme-light)] transition" rows="4" placeholder="ä¾‹å¦‚ï¼šè¨˜å¾—å¸¶åŒ–å¦åŒ…ã€è¦åœ¨è»Šç«™è²·é£¯..." value={memo || ''} onChange={(e) => onUpdate(e.target.value)}></textarea>
                <div className="absolute bottom-2 right-2 text-[10px] text-[var(--theme-color)] font-bold opacity-50">POWERME</div>
            </div>
        );

        const HSRTicket = ({ transport, onUpdate }) => {
            const { type, trainNo, from, to, paymentStatus, customText, departTime, arriveTime, price, seatType } = transport || {};
            
            const updateField = (field, value) => {
                const newData = { ...transport, [field]: value };
                // Auto calculate price if possible
                if ((field === 'from' || field === 'to' || field === 'seatType') && newData.from && newData.to && newData.seatType) {
                    const newPrice = getTicketPrice(newData.from, newData.to, newData.seatType);
                    if(newPrice) newData.price = newPrice;
                }
                onUpdate(newData); 
            };

            if (!type) return (
                <div className="flex gap-2 mt-2">
                    <button onClick={() => onUpdate({type: 'HSR', seatType: 'å°è™Ÿåº§'})} className="flex-1 text-[var(--theme-color)] rounded-lg p-2 text-sm font-bold border border-[var(--theme-light)] hover:bg-[var(--theme-bg)] transition" style={{backgroundColor: 'var(--theme-bg)'}}>ğŸš„ é«˜éµ</button>
                    <button onClick={() => onUpdate({type: 'SELF'})} className="flex-1 bg-gray-100 text-gray-600 rounded-lg p-2 text-sm font-bold border border-gray-200 hover:bg-gray-200 transition">ğŸš— è‡ªç†</button>
                </div>
            );

            if (type === 'SELF') return (
                 <div className="mt-3 bg-white border border-gray-200 rounded-xl p-4 relative shadow-sm">
                    <button onClick={() => onUpdate(null)} className="absolute top-2 right-2 text-gray-300 hover:text-red-400"><Icon name="X" size={16} /></button>
                    <label className="text-xs text-gray-500 font-bold block mb-1">è‡ªç†æ–¹å¼å‚™è¨»</label>
                    <input type="text" placeholder="ä¾‹ï¼šé–‹è»Šã€æ­ä¾¿è»Š..." value={customText || ''} onChange={(e) => updateField('customText', e.target.value)} className="cute-input w-full"/>
                </div>
            );

            return (
                <div className="mt-4 jp-ticket">
                    <div className="jp-ticket-header"><span className="flex items-center gap-1.5"><Icon name="Train" size={16}/> HSR TICKET</span><span className="text-[10px] opacity-80 font-mono">2025</span></div>
                    <div className="jp-ticket-body">
                        <button onClick={() => onUpdate(null)} className="absolute top-2 right-2 text-gray-300 hover:text-red-400 z-20 bg-white rounded-full"><Icon name="X" size={16}/></button>
                        
                        <div className="flex items-center justify-between mb-4 px-2">
                            <select className="bg-transparent font-black text-2xl outline-none w-24 text-gray-700 appearance-none cursor-pointer hover:text-[var(--theme-color)] transition relative z-30" value={from || ''} onChange={(e) => updateField('from', e.target.value)}><option value="">Start</option>{STATIONS.map(s => <option key={s} value={s}>{s}</option>)}</select>
                            <div className="flex flex-col items-center"><Icon name="ArrowRight" className="text-[var(--theme-light)]" size={20} /><div className="text-[9px] font-bold text-gray-300 tracking-widest mt-1">TO</div></div>
                            <select className="bg-transparent font-black text-2xl outline-none w-24 text-right text-gray-700 appearance-none cursor-pointer hover:text-[var(--theme-color)] transition relative z-30" value={to || ''} onChange={(e) => updateField('to', e.target.value)}><option value="">End</option>{STATIONS.map(s => <option key={s} value={s}>{s}</option>)}</select>
                        </div>
                        
                        <div className="border-t-2 border-dashed border-gray-200 mb-4 -mx-5"></div>
                        
                        <div className="space-y-4 mb-4">
                            {/* Seat Type Selector */}
                            <div className="flex gap-2">
                                {['å°è™Ÿåº§', 'è‡ªç”±åº§'].map(type => (
                                    <button key={type} onClick={() => updateField('seatType', type)} className={`seat-btn ${seatType === type ? 'selected' : ''}`}>{type}</button>
                                ))}
                            </div>

                            <div className="flex items-center justify-between gap-4">
                                <div className="flex-1 min-w-0"><label className="text-[9px] font-bold text-gray-400 uppercase tracking-wide block mb-1">DEP æ™‚é–“</label><TimeSelector value={departTime} onChange={(val) => updateField('departTime', val)} /></div>
                                <div className="text-gray-300 pt-4">â¤</div>
                                <div className="flex-1 min-w-0"><label className="text-[9px] font-bold text-gray-400 uppercase tracking-wide block mb-1">ARR æ™‚é–“</label><TimeSelector value={arriveTime} onChange={(val) => updateField('arriveTime', val)} /></div>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 mb-4 bg-gray-50 p-2 rounded-lg border border-gray-100">
                            <span className="text-sm font-bold text-gray-400">ç¥¨åƒ¹ $</span>
                            <input type="number" inputMode="numeric" placeholder="0" className="bg-transparent font-mono font-bold text-lg text-gray-700 outline-none w-full" value={price || ''} onChange={(e) => updateField('price', e.target.value)} />
                        </div>

                        <div className="flex items-end justify-between pt-2">
                            <div className="flex gap-2">
                                {['æœªè«‹æ¬¾', 'å·²è«‹æ¬¾', 'å…¬å¸ä»˜æ¬¾'].map((status) => (
                                    <button key={status} onClick={() => updateField('paymentStatus', status)} className={`stamp-btn ${paymentStatus === status ? 'active' : ''}`}>{status}</button>
                                ))}
                            </div>
                            <div className="opacity-30"><Icon name="QrCode" size={32} /></div>
                        </div>
                    </div>
                </div>
            );
        };

        const HotelCard = ({ accommodation, weekLocation, onUpdate }) => {
            const accommodationSearchLink = accommodation ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(accommodation)}` : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(weekLocation + 'ä½å®¿')}`;
            return (
                <div className="hotel-pass mt-2">
                    <div className="hotel-pass-header">
                        <div className="flex items-center gap-2">
                            <div className="p-1.5 rounded-lg text-white" style={{backgroundColor: 'var(--theme-light)'}}><Icon name="Bed" size={16} /></div>
                            <span className="text-sm font-bold text-gray-700 tracking-wider">BOOKING</span>
                        </div>
                        <div className="text-[10px] font-bold text-white px-2 py-0.5 rounded-full" style={{backgroundColor: 'var(--theme-light)'}}>PASS</div>
                    </div>
                    <div className="p-5 bg-gradient-to-b from-white to-[var(--theme-bg)]/30 space-y-4">
                        <div>
                            <label className="text-[10px] font-bold text-gray-400 block mb-1.5 uppercase tracking-wide">Hotel Name</label>
                            <input type="text" placeholder="è¼¸å…¥ä½å®¿åç¨±..." className="w-full text-lg font-bold text-gray-800 bg-transparent border-b-2 border-purple-100 pb-1 outline-none focus:border-[var(--theme-color)] transition-colors placeholder-gray-300" value={accommodation || ''} onChange={(e) => onUpdate(e.target.value)} />
                        </div>
                        <div className="flex gap-2 pt-2">
                            <a href={accommodationSearchLink} target="_blank" className="flex-1 text-white text-xs font-bold py-2 rounded-xl flex items-center justify-center gap-1 shadow-md hover:opacity-90 transition active:scale-95" style={{backgroundColor: 'var(--theme-color)', boxShadow: '0 4px 6px var(--theme-fade)'}}>
                                <Icon name="Navigation" size={14} /> å°èˆª
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        const ExpenseModal = ({ isOpen, onClose, data = {} }) => {
            if (!isOpen) return null;
            
            const stats = { 'æœªè«‹æ¬¾': {count:0, amount:0}, 'å·²è«‹æ¬¾': {count:0, amount:0}, 'å…¬å¸ä»˜æ¬¾': {count:0, amount:0} };
            const details = [];

            if (data) {
                Object.entries(data).forEach(([key, val]) => {
                    if (!val || val.type !== 'HSR') return;
                    const status = val.paymentStatus || 'æœªè«‹æ¬¾';
                    const price = parseInt(val.price || 0);
                    if (stats[status]) {
                        stats[status].count += 1;
                        stats[status].amount += price;
                    }
                    const [_, weekStr, dir] = key.split('_');
                    details.push({ 
                        id: key, 
                        week: weekStr, 
                        dir: dir === 'out' ? 'å»ç¨‹' : 'å›ç¨‹',
                        status, 
                        price,
                        info: `${val.from || '?'} â†’ ${val.to || '?'}`
                    });
                });
            }

            details.sort((a, b) => parseInt(a.week) - parseInt(b.week));

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center p-4 pointer-events-auto" onClick={onClose}>
                    <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl relative max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <div className="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6 sm:hidden"></div>
                        <h3 className="text-xl font-bold text-center text-gray-800 mb-6 flex items-center justify-center gap-2"><Icon name="Wallet" size={24}/> è»Šç¥¨å¸³æœ¬</h3>
                        
                        <div className="grid grid-cols-3 gap-3 mb-6">
                            <div className="bg-rose-50 border border-rose-100 p-3 rounded-xl text-center">
                                <div className="text-[10px] font-bold text-rose-400 mb-1">ğŸ”´ å¾…è«‹æ¬¾</div>
                                <div className="text-lg font-black text-rose-600">${stats['æœªè«‹æ¬¾'].amount}</div>
                                <div className="text-[9px] text-rose-300">{stats['æœªè«‹æ¬¾'].count} å¼µ</div>
                            </div>
                            <div className="bg-amber-50 border border-amber-100 p-3 rounded-xl text-center">
                                <div className="text-[10px] font-bold text-amber-400 mb-1">ğŸŸ¡ å·²è«‹æ¬¾</div>
                                <div className="text-lg font-black text-amber-600">${stats['å·²è«‹æ¬¾'].amount}</div>
                                <div className="text-[9px] text-amber-300">{stats['å·²è«‹æ¬¾'].count} å¼µ</div>
                            </div>
                            <div className="bg-emerald-50 border border-emerald-100 p-3 rounded-xl text-center">
                                <div className="text-[10px] font-bold text-emerald-400 mb-1">ğŸ¢ å…¬å¸ä»˜</div>
                                <div className="text-lg font-black text-emerald-600">${stats['å…¬å¸ä»˜æ¬¾'].amount}</div>
                                <div className="text-[9px] text-emerald-300">{stats['å…¬å¸ä»˜æ¬¾'].count} å¼µ</div>
                            </div>
                        </div>

                        <div className="space-y-3">
                            <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">æ˜ç´°æ¸…å–®</h4>
                            {details.length === 0 ? (
                                <div className="text-center py-8 text-gray-400 text-sm">é‚„æ²’æœ‰è»Šç¥¨ç´€éŒ„å–” ğŸ˜´</div>
                            ) : details.map((item) => (
                                <div key={item.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-100">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-white w-10 h-10 rounded-lg flex flex-col items-center justify-center border border-gray-100 text-xs font-bold text-gray-500 shadow-sm">
                                            <span>W{item.week}</span>
                                            <span className="text-[8px] text-gray-300">{item.dir}</span>
                                        </div>
                                        <div>
                                            <div className="text-sm font-bold text-gray-700">{item.info}</div>
                                            <div className={`text-[10px] font-bold px-1.5 py-0.5 rounded inline-block mt-0.5 ${item.status === 'æœªè«‹æ¬¾' ? 'bg-rose-100 text-rose-500' : item.status === 'å·²è«‹æ¬¾' ? 'bg-amber-100 text-amber-500' : 'bg-emerald-100 text-emerald-500'}`}>{item.status}</div>
                                        </div>
                                    </div>
                                    <div className="font-mono font-bold text-gray-700">${item.price}</div>
                                </div>
                            ))}
                        </div>

                        <button onClick={onClose} className="w-full py-3 rounded-xl bg-gray-900 text-white font-bold shadow-lg hover:bg-gray-800 transition mt-6">é—œé–‰</button>
                    </div>
                </div>
            );
        };

        const SettingsModal = ({ isOpen, onClose, currentThemeId, onThemeChange, hidePast, onToggleHidePast, onResetData }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 pointer-events-auto" onClick={onClose}>
                    <div className="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                        <h3 className="text-xl font-bold text-center text-gray-800 mb-6 flex items-center justify-center gap-2">è¨­å®š</h3>
                        
                        <div className="mb-6">
                            <label className="text-xs font-bold text-gray-400 block mb-3 uppercase tracking-wide">ä¸»é¡Œè‰²ç³»</label>
                            <div className="flex justify-between px-2">
                                {THEMES.map(t => (
                                    <div key={t.id} className="flex flex-col items-center gap-1">
                                        <div onClick={() => onThemeChange(t.id)} className={`color-swatch ${currentThemeId === t.id ? 'selected' : ''}`} style={{backgroundColor: t.color}}>
                                            {currentThemeId === t.id && <Icon name="Check" size={20} className="text-white"/>}
                                        </div>
                                        <span className="text-[10px] text-gray-500 font-bold">{t.name}</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="mb-6">
                            <label className="text-xs font-bold text-gray-400 block mb-3 uppercase tracking-wide">é¡¯ç¤ºè¨­å®š</label>
                            <div className="flex items-center justify-between bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <span className="font-bold text-gray-600 text-sm">éš±è—éæœŸè³½ç¨‹</span>
                                <div className="relative inline-block w-12 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="hidePast" id="hidePast" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0 top-0" checked={hidePast} onChange={onToggleHidePast} style={{right: hidePast ? '0' : 'auto', left: hidePast ? 'auto' : '0', borderColor: hidePast ? 'var(--theme-color)' : '#E5E7EB'}}/>
                                    <label htmlFor="hidePast" className="block overflow-hidden h-6 rounded-full bg-gray-200 cursor-pointer" style={{backgroundColor: hidePast ? 'var(--theme-color)' : '#E5E7EB'}}></label>
                                </div>
                            </div>
                        </div>

                        <div className="mb-4">
                            <label className="text-xs font-bold text-gray-400 block mb-3 uppercase tracking-wide">è³‡æ–™ç®¡ç†</label>
                            <button onClick={() => { if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) { onResetData(); onClose(); } }} className="w-full py-3 rounded-xl bg-red-50 text-red-500 font-bold border border-red-100 hover:bg-red-100 transition flex items-center justify-center gap-2"><Icon name="Trash" size={16}/> æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                        </div>

                        <button onClick={onClose} className="w-full py-3 rounded-xl bg-gray-900 text-white font-bold shadow-lg hover:bg-gray-800 transition mt-2">å®Œæˆ</button>
                    </div>
                </div>
            );
        };

        const RosterEditModal = ({ isOpen, onClose, currentRoster, onSave }) => {
            const [selected, setSelected] = useState([]);
            useEffect(() => { if (isOpen) setSelected([...currentRoster]); }, [isOpen, currentRoster]);
            const toggleMember = (name) => { if (selected.includes(name)) { setSelected(selected.filter(n => n !== name)); } else { setSelected([...selected, name]); } };
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 pointer-events-auto" onClick={onClose}>
                    <div className="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                        <h3 className="text-xl font-bold text-center mb-6" style={{color: 'var(--theme-color)'}}>ç·¨è¼¯å‡ºå¸­åå–®</h3>
                        <div className="grid grid-cols-4 gap-3 mb-8">
                            {ALL_MEMBERS.map(name => (
                                <button key={name} onClick={() => toggleMember(name)} className={`aspect-square rounded-2xl flex items-center justify-center text-sm font-bold border-2 transition-all ${selected.includes(name) ? 'text-white shadow-lg transform scale-105' : 'bg-white text-gray-400 border-gray-100'}`} style={selected.includes(name) ? {backgroundColor: 'var(--theme-color)', borderColor: 'var(--theme-color)', boxShadow: '0 4px 10px var(--theme-fade)'} : {}}>
                                    {name}
                                </button>
                            ))}
                        </div>
                        <div className="flex gap-3">
                            <button onClick={onClose} className="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold hover:bg-gray-200 transition">å–æ¶ˆ</button>
                            <button onClick={() => { onSave(selected); onClose(); }} className="flex-1 py-3 rounded-xl text-white font-bold shadow-lg hover:opacity-90 transition" style={{backgroundColor: 'var(--theme-color)', boxShadow: '0 4px 10px var(--theme-fade)'}}>å„²å­˜</button>
                        </div>
                    </div>
                </div>
            );
        };

        const TripDetailModal = ({ isOpen, onClose, weekData, user, savedData, onSaveData }) => {
            if (!isOpen) return null;
            const weekId = `week_${weekData.week}`;
            const transportOut = savedData.transport?.[`${weekId}_out`];
            const transportIn = savedData.transport?.[`${weekId}_in`];
            const accommodation = savedData.accommodation?.[weekId];
            const memo = savedData.memos?.[weekId];

            return (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
                    <div className="absolute inset-0 bg-black/20 backdrop-blur-[2px] pointer-events-auto transition-opacity" onClick={onClose}></div>
                    <div className="bg-[#FAFAFA] w-full max-w-md sm:rounded-[32px] rounded-t-[32px] p-6 pointer-events-auto transform transition-transform duration-300 ease-out shadow-[0_-10px_40px_rgba(0,0,0,0.1)] max-h-[85vh] overflow-y-auto">
                        <div className="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
                        <div className="flex justify-between items-center mb-6">
                            <div><h3 className="text-2xl font-bold text-gray-800">è¡Œç¨‹è¦åŠƒ</h3><p className="text-xs text-gray-400 font-bold mt-1">ç¬¬ {weekData.week} é€± â€¢ {weekData.location}</p></div>
                            <button onClick={onClose} className="w-10 h-10 bg-white rounded-full shadow-sm border border-gray-100 flex items-center justify-center text-gray-400 hover:text-gray-600 transition"><Icon name="X" size={20} /></button>
                        </div>
                        <HotelCard accommodation={accommodation} weekLocation={weekData.location} onUpdate={(val) => onSaveData('accommodation', weekId, val)} />
                        <div className="dashed-line w-full my-8"></div>
                        <div className="space-y-6">
                            <div><h4 className="text-sm font-bold text-gray-800 mb-2 flex items-center gap-2"><div className="w-6 h-6 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center">Go</div> å»ç¨‹äº¤é€š</h4><HSRTicket transport={transportOut} onUpdate={(d) => onSaveData('transport', `${weekId}_out`, d)} /></div>
                            <div><h4 className="text-sm font-bold text-gray-800 mb-2 flex items-center gap-2"><div className="w-6 h-6 rounded-full bg-pink-100 text-pink-500 flex items-center justify-center">Back</div> å›ç¨‹äº¤é€š</h4><HSRTicket transport={transportIn} onUpdate={(d) => onSaveData('transport', `${weekId}_in`, d)} /></div>
                        </div>
                        <MemoCard memo={memo} onUpdate={(val) => onSaveData('memos', weekId, val)} />
                        <div className="h-20"></div>
                    </div>
                    <div className="absolute bottom-6 left-0 right-0 px-6 pointer-events-none">
                        <button onClick={onClose} className="w-full max-w-md mx-auto bg-gray-900 text-white py-4 rounded-2xl font-bold shadow-xl pointer-events-auto active:scale-95 transition-transform flex items-center justify-center gap-2"><Icon name="Check" size={18} /> å®Œæˆè¦åŠƒ</button>
                    </div>
                </div>
            );
        };

        const WeekCard = ({ weekData, user, savedData, onSaveData }) => {
            const [isTripModalOpen, setIsTripModalOpen] = useState(false);
            const [editingMatchId, setEditingMatchId] = useState(null);
            const isMyWeek = weekData.matches.some(m => { const roster = savedData.rosters?.[m.id] || m.roster; return roster.includes(user); });
            const isThemeWeek = weekData.matches.some(m => m.themeDay);
            const matchesByDay = weekData.matches.reduce((acc, match) => { const dayKey = `${match.date} (${match.day})`; if (!acc[dayKey]) acc[dayKey] = []; acc[dayKey].push(match); return acc; }, {});

            return (
                <div className={`mb-6 rounded-[32px] overflow-hidden transition-all duration-500 ${isThemeWeek ? 'border-2 shadow-xl' : 'bg-white border border-gray-100 shadow-lg shadow-gray-100'}`} style={isThemeWeek ? {borderColor: 'var(--theme-light)', backgroundColor: 'var(--theme-bg)', boxShadow: '0 10px 20px var(--theme-fade)'} : {}}>
                    <div className={`px-6 py-4 flex justify-between items-center ${isThemeWeek ? '' : 'bg-gray-50/80'}`} style={isThemeWeek ? {backgroundColor: 'rgba(255,255,255,0.6)'} : {}}>
                        <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-2xl flex items-center justify-center text-sm font-black shadow-sm ${isThemeWeek ? 'text-white' : 'bg-white text-gray-400'}`} style={isThemeWeek ? {backgroundColor: 'var(--theme-color)'} : {}}> {weekData.week} </div>
                            <div><div className="text-[10px] font-bold text-gray-400 tracking-wider uppercase mb-0.5">WEEK</div><div className="font-bold text-gray-700 text-sm flex items-center gap-1"><Icon name="MapPin" size={12} className="text-gray-400" /> {weekData.location}</div></div>
                        </div>
                        {isThemeWeek && (<div className="px-3 py-1 text-white text-[10px] font-bold rounded-full shadow-md flex items-center gap-1" style={{background: 'linear-gradient(135deg, #FCD34D, #F59E0B)'}}><Icon name="Sparkles" size={10} /> ä¸»é¡Œæ—¥</div>)}
                    </div>
                    <div className="p-4 space-y-4">
                        {Object.entries(matchesByDay).map(([dateStr, matches]) => (
                            <div key={dateStr} className="bg-white/60 border-2 border-dashed border-gray-200 rounded-[24px] p-4 relative">
                                <div className="flex justify-between items-center mb-3 border-b border-gray-100 pb-2"><div className="text-sm font-bold text-gray-500">{dateStr}</div><WeatherWidget location={weekData.location} date={matches[0].date} /></div>
                                {matches.map((match) => {
                                    const isMizuno = match.team.includes('ç¾æ´¥æ¿ƒ') || match.team.includes('ç”·å­');
                                    const currentRoster = savedData.rosters?.[match.id] || match.roster;
                                    const score = savedData.scores?.[match.id] || '';
                                    const isInRoster = currentRoster.includes(user);
                                    return (
                                        <div key={match.id} className={`mb-4 last:mb-0 ${isInRoster ? '' : 'opacity-60'}`}>
                                            <div className="flex justify-between items-center mb-2">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-mono text-lg font-black text-gray-800">{match.time}</span>
                                                    <span className={`px-3 py-1 text-sm font-black tracking-wide rounded-lg text-white shadow-sm ${isMizuno ? 'bg-blue-500' : 'bg-rose-500'}`}>{match.team.replace('é›²æ—ç¾æ´¥æ¿ƒ','ç¾æ´¥æ¿ƒ').replace('æ–°åŒ—ä¸­çº–','ä¸­çº–')}</span>
                                                </div>
                                                <input type="text" placeholder="-" className="w-10 h-8 text-center font-mono font-bold bg-gray-50 rounded-lg border-none outline-none focus:ring-2 transition text-sm" style={{focusRingColor: 'var(--theme-light)'}} value={score} onChange={(e) => onSaveData('scores', match.id, e.target.value)} />
                                            </div>
                                            <div className="flex flex-wrap gap-1.5 items-center">
                                                {currentRoster.map(name => (<span key={name} className={`text-[10px] font-bold px-2 py-0.5 rounded-md border ${name === user ? 'text-white' : 'bg-white text-gray-500 border-gray-100'}`} style={name === user ? {backgroundColor: 'var(--theme-color)', borderColor: 'var(--theme-color)'} : {}}>{name}</span>))}
                                                <button onClick={() => setEditingMatchId(match.id)} className="w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-gray-200"><Icon name="Edit2" size={10} /></button>
                                            </div>
                                            {match.note && <div className="text-[10px] text-gray-400 mt-1 ml-1">* {match.note}</div>}
                                        </div>
                                    );
                                })}
                            </div>
                        ))}
                    </div>
                    {isMyWeek && (<div className="p-4 pt-0"><button onClick={() => setIsTripModalOpen(true)} className="w-full py-3 bg-gray-900 text-white rounded-2xl font-bold text-sm shadow-lg shadow-gray-200 active:scale-95 transition-transform flex items-center justify-center gap-2"><Icon name="Edit2" size={14} /> å¡«å¯«äº¤é€šä½å®¿</button></div>)}
                    <TripDetailModal isOpen={isTripModalOpen} onClose={() => setIsTripModalOpen(false)} weekData={weekData} user={user} savedData={savedData} onSaveData={onSaveData} />
                    {editingMatchId && (<RosterEditModal isOpen={true} currentRoster={savedData.rosters?.[editingMatchId] || weekData.matches.find(m => m.id === editingMatchId).roster} onClose={() => setEditingMatchId(null)} onSave={(newRoster) => onSaveData('rosters', editingMatchId, newRoster)} />)}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(safeGet('powerme_user') || '');
            const [showMyOnly, setShowMyOnly] = useState(false);
            const [hidePast, setHidePast] = useState(safeGet('powerme_hide_past') === 'true');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isExpenseOpen, setIsExpenseOpen] = useState(false);
            const [themeId, setThemeId] = useState(safeGet('powerme_theme') || 'pink');
            
            // --- AUTO REPAIR DATA ON LOAD ---
            const [savedData, setSavedData] = useState(() => {
                const DEFAULT_DATA = { scores: {}, rosters: {}, transport: {}, accommodation: {}, roommates: {}, memos: {} };
                try {
                    const local = safeGet('powerme_data');
                    if (!local) return DEFAULT_DATA;
                    const parsed = JSON.parse(local);
                    // Force Merge to prevent crash on missing keys
                    return { ...DEFAULT_DATA, ...parsed };
                } catch(e) {
                    return DEFAULT_DATA;
                }
            });

            // Effect to hide loader when React is ready
            useEffect(() => {
                hideLoader();
            }, []);

            useEffect(() => {
                const theme = THEMES.find(t => t.id === themeId) || THEMES[0];
                const root = document.documentElement;
                root.style.setProperty('--theme-color', theme.color);
                root.style.setProperty('--theme-light', theme.light);
                root.style.setProperty('--theme-bg', theme.bg);
                root.style.setProperty('--theme-fade', `${theme.color}20`);
                safeSet('powerme_theme', themeId);
            }, [themeId]);

            useEffect(() => { if (user) safeSet('powerme_user', user); else safeRemove('powerme_user'); }, [user]);
            useEffect(() => { safeSet('powerme_data', JSON.stringify(savedData)); }, [savedData]);
            useEffect(() => { safeSet('powerme_hide_past', hidePast); }, [hidePast]);

            const handleSaveData = (category, id, value) => { 
                setSavedData(prev => {
                    const catData = prev[category] || {};
                    return { ...prev, [category]: { ...catData, [id]: value } };
                }); 
            };
            const handleResetData = () => { setSavedData({ scores: {}, rosters: {}, transport: {}, accommodation: {}, roommates: {}, memos: {} }); window.location.reload(); };

            const groupedSchedule = useMemo(() => {
                const groups = {};
                SCHEDULE.forEach(match => {
                    const key = match.week;
                    if (!groups[key]) { groups[key] = { week: match.week, location: match.location, date: match.date, day: match.day, matches: [] }; }
                    match.matches.forEach(m => { groups[key].matches.push({ ...m, date: match.date, day: match.day }); });
                });
                let sorted = Object.values(groups).sort((a, b) => a.week - b.week);
                
                if (hidePast) {
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    sorted = sorted.filter(group => {
                        const lastMatch = group.matches[group.matches.length - 1];
                        const parts = lastMatch.date.split('/');
                        const lastDate = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]), 23, 59, 59);
                        return lastDate >= today; 
                    });
                }
                return sorted;
            }, [hidePast]);

            if (!user) {
                return (
                    <div className="min-h-screen relative overflow-hidden journal-bg flex flex-col items-center justify-center p-4">
                        <div className="absolute top-10 left-10 text-[var(--theme-light)] opacity-60 animate-float"><Icon name="Heart" size={40} /></div>
                        <div className="absolute bottom-20 right-10 text-yellow-300 opacity-60 animate-float-delay"><Icon name="Star" size={40} /></div>
                        <div className="relative bg-white px-6 pt-8 pb-8 rounded-[24px] w-full max-w-sm transform -rotate-2 border-2 border-[var(--theme-light)] shadow-[6px_6px_0px_rgba(0,0,0,0.05)]">
                            <div className="absolute -top-3 left-1/2 transform -translate-x-1/2 w-28 h-6 rotate-1 shadow-sm" style={{backgroundColor: 'var(--theme-light)', opacity: 0.8, maskImage: 'repeating-linear-gradient(135deg,black,black 10px,transparent 10px,transparent 20px)', WebkitMaskImage: 'repeating-linear-gradient(135deg,black,black 10px,transparent 10px,transparent 20px)'}}></div>
                            <div className="text-center mb-4 relative z-10">
                                <div className="logo-sticker relative inline-block transform -rotate-3 hover:rotate-0 transition-transform duration-300 mb-1">
                                    <div className="absolute inset-0 bg-white rounded-3xl transform scale-105 border-2 border-[var(--theme-light)]"></div>
                                    <img src="./image_82155e.jpg" onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/400x400/FBCFE8/ffffff?text=Powerme+Girls"; }} alt="Logo" className="w-48 h-auto relative rounded-2xl shadow-sm bg-white p-1" />
                                </div>
                                <h2 className="text-xl font-bold text-gray-400 tracking-widest uppercase mt-1 font-mono">Powerme Girl's Pocket</h2>
                            </div>
                            <p className="text-gray-500 mb-4 text-center text-xs font-bold inline-block px-3 py-1 rounded-full mx-auto block w-max" style={{backgroundColor: 'var(--theme-bg)'}}>âœ¨ è«‹é»é¸å¦³çš„åå­— âœ¨</p>
                            <div className="grid grid-cols-4 gap-3">
                                {ALL_MEMBERS.map(name => (
                                    <button key={name} onClick={() => setUser(name)} className="sticker-btn aspect-square rounded-full flex items-center justify-center font-bold text-gray-600 hover:text-white text-xs relative group" style={{backgroundColor: 'var(--theme-bg)'}} onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'var(--theme-color)'} onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'var(--theme-bg)'}>
                                        <span className="relative z-10">{name}</span>
                                        <div className="absolute inset-0 rounded-full border-2 border-dashed border-white opacity-50"></div>
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="mt-8 text-[10px] font-bold text-gray-400 tracking-wider flex items-center gap-1"><Icon name="Heart" size={10} /> TVL 21 å¹´è¯è³½æ‡‰æ´å°å·¥å…· <Icon name="Heart" size={10} /></div>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 relative shadow-2xl bg-[var(--theme-bg)] transition-colors duration-500">
                    <header className="sticky top-0 z-30 bg-white/80 backdrop-blur-md px-5 py-4 border-b border-[var(--theme-light)] flex justify-between items-center washi-header">
                        <div>
                            <h1 className="font-black text-xl leading-none flex items-center gap-2 drop-shadow-sm" style={{color: 'var(--theme-color)'}}>
                                <Icon name="BookHeart" size={20} /> <span>Powerme Girls</span> <span className="text-2xl transform rotate-12 inline-block ml-1">ğŸ€</span>
                            </h1>
                            <div className="text-[10px] text-gray-500 font-bold pl-6">Hi, {user}</div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setIsExpenseOpen(true)} className="w-10 h-10 bg-white rounded-full text-gray-400 border border-gray-100 flex items-center justify-center transition shadow-sm hover:text-[var(--theme-color)] hover:bg-[var(--theme-bg)]"><Icon name="Wallet" size={20} /></button>
                            <button onClick={() => setIsSettingsOpen(true)} className="w-10 h-10 bg-white rounded-full text-gray-400 border border-gray-100 flex items-center justify-center transition shadow-sm hover:text-[var(--theme-color)] hover:bg-[var(--theme-bg)]"><Icon name="Settings" size={20} /></button>
                            <button onClick={() => setUser('')} className="w-10 h-10 bg-white rounded-full text-gray-400 border border-gray-100 flex items-center justify-center hover:bg-red-50 hover:text-red-500 transition shadow-sm"><Icon name="LogOut" size={20} /></button>
                        </div>
                    </header>

                    <div className="px-5 pt-6 pb-2">
                        <div className="flex items-center justify-between">
                            <h2 className="text-2xl font-black text-gray-800">Schedule</h2>
                            <div className="relative inline-block w-28 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-1 top-1" checked={showMyOnly} onChange={() => setShowMyOnly(!showMyOnly)}/>
                                <label htmlFor="toggle" className={`toggle-label block overflow-hidden h-8 rounded-full cursor-pointer border-2 font-bold text-[10px] leading-7 px-2 transition-colors duration-300 text-center ${showMyOnly ? 'text-white pl-2 text-left' : 'bg-gray-200 border-gray-200 text-gray-400 pl-8 text-right'}`} style={showMyOnly ? {backgroundColor: 'var(--theme-color)', borderColor: 'var(--theme-color)'} : {}}> {showMyOnly ? 'åªçœ‹æˆ‘çš„' : 'é¡¯ç¤ºå…¨éƒ¨'} </label>
                            </div>
                        </div>
                    </div>

                    <main className="p-5 pt-2 space-y-2">
                        {groupedSchedule.filter(weekData => !showMyOnly || weekData.matches.some(m => (savedData.rosters?.[m.id] || m.roster).includes(user))).map((weekData) => (
                            <WeekCard key={weekData.week} weekData={weekData} user={user} savedData={savedData} onSaveData={handleSaveData} />
                        ))}
                        {groupedSchedule.length === 0 && <div className="text-center py-20 text-gray-400 font-bold"><div className="text-4xl mb-2">ğŸƒ</div> æ²’æœ‰æ›´å¤šè³½ç¨‹å›‰ï¼</div>}
                        {groupedSchedule.length > 0 && groupedSchedule.filter(w => !showMyOnly || w.matches.some(m => (savedData.rosters?.[m.id] || m.roster).includes(user))).length === 0 && (
                            <div className="text-center py-20 text-gray-400 font-bold"><div className="text-4xl mb-2">ğŸ˜´</div> ç›®å‰æ²’æœ‰å¦³çš„ç­è¡¨å–”ï¼</div>
                        )}
                    </main>

                    <SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} currentThemeId={themeId} onThemeChange={setThemeId} hidePast={hidePast} onToggleHidePast={() => setHidePast(!hidePast)} onResetData={handleResetData} />
                    <ExpenseModal isOpen={isExpenseOpen} onClose={() => setIsExpenseOpen(false)} data={savedData.transport} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>